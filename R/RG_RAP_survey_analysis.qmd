---
title: "Regions Group RAP survey results"
author: "Jake Tufts"
date-modified: "`r Sys.Date()`"
format: 
  html:
    embed-resources: true
---

## Introduction

This Quarto document analyses the 2023 (early 2024) RAP Survey results for the Regions Group division. The areas focused on are:

- Most common/important needs in your area
- Biggest problems for people in your area when attempting RAP
- Ideas to support the people in your area with RAP


```{r}
#| label: load
#| echo: false
#| output: false

library(here)
library(ggplot2)
library(afcolours)
library(glue)
library(waffle)
source(here('R', 'helpers.R'))
source(here('R', 'load_data.R'))
source(here('R', 'visualisations.R'))
source(here('R', 'transform.R'))

# Subset results for RG
choose_divisions <- c("Regions Group")

# All reponses
division_data_full <- RAP_full %>%
  filter_for_divisions(choose_divisions)

# Unique responses
division_data <- RAP_full %>%
  filter_for_divisions(choose_divisions) |>
  filter(!duplicated(Email, fromLast = TRUE))
  
```



## Population

Here we look at the Regions Group population.

```{r}
#| label: waffle-plot
#| echo: false

waffle_pop_plot(df_div = division_data_full,
                df_all = RAP_full)

num_rg_resp <- nrow(division_data)

```


There were `r num_rg_resp` responses, of which came from `r length(unique(division_data$Email))` different respondents.


## Most common needs

Below is a bar chart of the survey questions which related to why people need RAP.
The answers to the questions were a ranking from Strongly disagree to Neutral to Strongly agree.
A bi-polar Likert scale is used (Disagreement is negative, Neutral is 0 and Agreement is positive).


```{r}
#| label: needs-bar
#| echo: false

# Convert to bi-polar Likert scale
bi_division_data_numerical <- rank_to_num(df = division_data,
                                       ranked_columns = ranked_columns,
                                       likert_scale_dictionary = bi_likert_scale_dictionary,
                                       numerical_ranking_factors = bi_numerical_ranking_factors)

# Organisation cols
org_cols <- division_data |> 
  select(1:which(names(division_data)=="Group")) |> 
  colnames()

# Convert num survey qs to long
needs_qs <- c("repetitive_tasks", "figuring_out_existing_processes_time_consuming",
                "someone_else_could_run", "re-run_old_versions", "QA_manual_checks")

div_data_num_long <- rank_to_long(bi_division_data_numerical, 
                                  cols_long = needs_qs)



# Dataframe storing rank values
sum_ranks <- data.frame(rank = ranking_factors, value = as.numeric(bi_numerical_ranking_factors))


# Bar chart
div_data_num_long |> 
  summarise(total_rank = mean(as.numeric_factor(responses)),
            .by = c("questions")) |> 
  arrange(desc(total_rank)) |> 
  mutate(questions = unlist(column_names_dictionary[questions]),
         questions = factor(questions, levels = questions)) |> 
  ggplot(aes(x = questions, y = total_rank)) +
  geom_col(fill = af_blue, colour = af_blue) +
  lapply(1:nrow(sum_ranks), function(i) {
    geom_hline(aes(yintercept = sum_ranks$value[i]), color = RG_colours[i], linetype = "dashed")
  }) +
  geom_text(aes(x = Inf, y = sum_ranks$value[1], label = sum_ranks$rank[1]),
              hjust = 1.2, color = RG_colours[1], vjust = -0.5) +
    geom_text(aes(x = Inf, y = sum_ranks$value[2], label = sum_ranks$rank[2]),
              hjust = 1.4, color = RG_colours[2], vjust = 1.5) +
    geom_text(aes(x = Inf, y = sum_ranks$value[3], label = sum_ranks$rank[3]),
              hjust = 1.5, color = RG_colours[3], vjust = 1.5) +
      geom_text(aes(x = Inf, y = sum_ranks$value[4], label = sum_ranks$rank[4]),
              hjust = 1.7, color = RG_colours[4], vjust = 1.5) +
      geom_text(aes(x = Inf, y = sum_ranks$value[5], label = sum_ranks$rank[5]),
              hjust = 1.3, color = RG_colours[5], vjust = 1.5) +
  labs(title = "Reptitive tasks and manual QA checks are recurring issues",
       subtitle = "Bar chart showing the average rank (using a bipolar Likert scale) of the survey\nquestions relating to needs for RAP.",
       x = "Survey questions",
       y = "Average of Likert ranked survey questions") +
  scale_x_discrete(labels = insert_line_breaks) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0)
  )



```

It should be noted that someone_else_could_run is a positively framed question.
So, disagreement infers a need to address the issue.


Now, we look at how many people use code.



```{r}
#| label: who-codes

# RAG bar chart for question I_use_code
division_data |>
  select(ID, I_use_code, comfortable_with_code) |>
  rank_to_long(cols_long = "I_use_code") |> 
  ggplot(aes(x = responses, fill = responses)) +
  geom_bar(colour = "black") +
  scale_fill_manual(values = likert_colours) +
  labs(
    title = "Most people use code, but there is room for more",
    subtitle = paste0("Bar chart showing count of people who responded to the",
                      ' question\n"I regularly perform analysis using code"',
                      " grouped by response."),
    x = "",
    y = "Count",
    fill = "Responses"
  ) +
  # facet_wrap(~ question) +
  theme_minimal()

```


The data is subset to include only those people who agreed with the 
"I regularly perform analysis using code" statement.
This is done to analyse the code-related questions.



```{r}
#| label: code-comfortability

code_qs <- c("comfortable_with_code", "open_source_tools", 
            "know_how_to_open_source", "version_control_confusing")

# Multi-panel plot of bar charts to show how coders rank code qs
division_data |> 
  filter(I_use_code %in% c("Strongly agree", "Agree")) |> 
  rank_to_long(cols_long = code_qs) |> 
  mutate(questions = unlist(column_names_dictionary[questions])) |> 
  ggplot(aes(x = responses, fill = responses)) +
  geom_bar(colour = "black") +
  scale_fill_manual(values = likert_colours) +
  labs(
    title = "Coders are less certain on Version control and open-sourcing",
    subtitle = paste0("Bar charts showing count of people who reponded to the",
                      " code related questionsgrouped by response."),
    x = "",
    y = "Count",
    fill = "Responses"
  ) +
  facet_wrap(~ questions) +
  theme_minimal()

```



```{r}

# # Lollipop plot to visualise how coders compare to non coders on RAP
#   mutate(across(all_of(ranked_columns), ~as.numeric_factor(.))) |> 
#   summarise(avg_rank = mean(responses), .by="questions") |> 
#   ggplot(aes(x = questions, y = avg_rank)) +
#   geom_point() +
#   geom_segment(aes(x=questions, xend=questions,
#                    y=0, yend=avg_rank ))
```









## Caveats

There are duplicate answers (where someone has filled out the survey twice).

Includes managers who are not necessarily involved in the day-to-day coding. 
